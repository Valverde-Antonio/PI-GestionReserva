<!-- <app-header [nombreUsuario]="'Profesor'"></app-header> -->

<div class="historial-wrapper">
  <h2>Histórico de Reservas</h2>

  <div class="filtros mb-4">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Filtrar por fecha:</label>
        <input type="date" class="form-control" [(ngModel)]="filtroFecha" (change)="filtrarReservas()">
      </div>
      <div class="col-md-4">
        <label class="form-label">Filtrar por tipo de material:</label>
        <select class="form-select" [(ngModel)]="filtroMaterial" (change)="filtrarReservas()">
          <option value="">Todos</option>
          <option value="proyector">Proyector</option>
          <option value="portátil">Portátiles</option>
          <option value="pizarra">Pizarra Digital</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Filtrar por aula:</label>
        <select class="form-select" [(ngModel)]="filtroAula" (change)="filtrarReservas()">
          <option value="">Todas</option>
          <option *ngFor="let aula of aulas" [value]="aula">{{ aula }}</option>
        </select>
      </div>
      <div class="col-12 d-flex justify-content-end">
        <button class="btn btn-secondary mt-3" (click)="limpiarFiltros()">Limpiar filtros</button>
      </div>
      <div class="text-end mb-3">
        <button class="btn btn-success" (click)="exportarPDFMisReservas()" [disabled]="filtradoReservas.length === 0">
          Exportar a PDF
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="filtradoReservas.length > 0; else noReservas">
    <div class="reserva-card" *ngFor="let r of filtradoReservas">
      <h3>{{ r.espacio }}</h3>
      <p *ngIf="r.recurso"><strong>Recurso:</strong> {{ r.recurso }}</p>
      <p *ngIf="!r.recurso"><strong>Motivo:</strong> {{ r.motivo || '-' }}</p>
      <p><strong>Fecha:</strong> {{ r.fecha }}</p>
      <p><strong>Hora:</strong> {{ r.horaInicio }} - {{ r.horaFin }}</p>
      <p><strong>Estado:</strong>
        <span class="estado" [class.finalizada]="r.estado === 'Finalizada'"
          [class.cancelada]="r.estado === 'Cancelada'">
          {{ r.estado }}
        </span>
      </p>
    </div>
  </div>

  <ng-template #noReservas>
    <div class="sin-historial">
      <p>No hay reservas con los filtros actuales.</p>
      <img src="assets/img/no-history.png" alt="Sin reservas" />
    </div>
  </ng-template>
</div>